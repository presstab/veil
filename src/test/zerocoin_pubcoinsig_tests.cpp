// Copyright (c) 2019 The Veil developers
// Copyright (c) 2019 The PIVX developers
// Distributed under the MIT software license, see the accompanying
// file COPYING or http://www.opensource.org/licenses/mit-license.php.
#include <test/test_veil.h>
#include "libzerocoin/Denominations.h"
#include "libzerocoin/PubcoinSignature.h"
#include "libzerocoin/bignum.h"
#include "streams.h"

#include <boost/test/unit_test.hpp>
#include <iostream>
#include <core_io.h>
#include <veil/zerocoin/zchain.h>
#include <chainparams.h>
#include <veil/invalid_list.h>
#include <univalue/include/univalue.h>
#include <veil/invalid.h>

using namespace libzerocoin;

BOOST_AUTO_TEST_SUITE(zerocoin_pubcoinsig_tests)

std::string zerocoinModulus = "25195908475657893494027183240048398571429282126204032027777137836043662020707595556264018525880784"
                              "4069182906412495150821892985591491761845028084891200728449926873928072877767359714183472702618963750149718246911"
                              "6507761337985909570009733045974880842840179742910064245869181719511874612151517265463228221686998754918242243363"
                              "7259085141865462043576798423387184774447920739934236584823824281198163815010674810451660377306056201619676256133"
                              "8441436038339044149526344321901146575444541784240209246165157233507787077498171257724679629263863563732899121548"
                              "31438167899885040445364023527381951378636564391212010397122822120720357";

std::string rawtx = "02000000000000010000000000000000000000000000000000000000000000000000000000000000fffffffffd9d2dc202992d04012102394de215719d2c444f4cc4c75cd292f2e0d808287a37fa77b0ada0339d8a0ef546304402200f46333c5f11d5f84b83792ead447e15c88fc942965f5c7897a4ad36f587e86002203d3b8c424926e78bbfdfacce804c34d853a3d274c2aea543089fc3cc5840ad02102700000000000070fa6ba6badd0bf4a44601838faf7f3fa357edce9a28f97b7a9226a46239d65058dd7a8186eebc87eb9b47861e0babdd4e5962008585d0cf99d33a5e402a6f0321261e47aa61d25220278b2792a848f68b8824b35d2640b6abb226ff098c234ff30046ffa3d86cb0662989bbbf46d47c5bb10decb0505fca545918a1777de4062de348e976751b502dd578ea91a532fd51e6dc4638cfc3fa880615930db81d0274bbaf5cfefc48df0d828c6065864174920103c821412692fc0415f41023c1125d9ffc5478ab04982d39215f783614c8b74a2c409bde6ef6dc1f2ce05555e3edd5a19bca8127010e4c4fa02f7bac4911f5096b17019368b12068508a10e6ac72647193622a172f3189e0a611e23358d4a75e0b2a0ab331265b108ff886d0f86c51a3f16c85798975f95f8c00fd00024ccfbf2c6039e6aea6a533d3ebac5828dabe30166978985e95fb4af903f390a861a5d2505e452d9c2db8671769bcafaacaa909701dd897dbff57efaba4fd28ffe720f0193c579801d4270242ca9cbece604cb3f2ad68563ff872e00514f109db719611c3e073236dd5eaee851f6d055521d640054c6aea2c9ed7ffeb093c73d4890ee36dd4e4efc26347e5f7c24f11bc396091b664b6116554d9ddb84758c8f8d1ec124adb38d5d3b454e21e61f981f8c32f8ae0f6ab4dd7b6572575170906e9ce46ec004c29a38f0e56aa31ff3f3569667d563afd69814ef237bb2895ca2ec4bc89d3f66b64f14e1d869bc9ae3e422d92c57aad3a714b324c503650f0a736a8f18b56d565b306dd0bacf015263336d1f66d52c5a4cc92c01373edea612900d762fed75efb57e70127884a7541a100fdbd0186056211456d1217988c05f9e461329e3613b28ac6dcb9dea8fa0a698f1db8ab10020098749e0a7b241b960f674b4a644f4e3ff4e66c4276f290ff4638133d908b9273706450da6bb983aa211371716aa939754798e27133f43fb96503f5c220a1fe4469f58228f6891be07f63639f5b4ef64eadf2afd6e9c039a0636d15ec16186384112b9b354738fd19640b51227be0d07db45cf2686621303db76fb97cd5d58dabf80e824c8f9606741e2df506bbf881d78c65b7de370fdfd3d65621c454018ffe8f9a79d7c7a04615c3847cfd0002c2cc68e60a3e0c9c5060c51c109a5c415c1b15de7e999a02481c70dbb0bc569e2cc02cf815be128a047f4392acd4c75489325815fc809617a4ccccfff46b06c6f4c185ee9c2b77f9ef8f4f29997a01f0e8ed5bef21f31d957a7d2968ec7bb371d608be2240fc05c0f9db56c03405a00f82c27110117e40bc0bd686d96b8c9b95fe7afdc7f8f4797f29c5670ba0a6bde8dcb055a2382809d6a2219b705bdbcdcb236a5fd9990994f7a0071ee68b660f6bc2dc7baf4a49fe160b46806b4ed581a68bb9d069b48c89a95e592b46aa2576b92963be372bf901e9416514da6dc92c308354cfc67f99edb69dbbe2c5b706561272802f0497f0cabafce730bfed1a9596045ed61084752c3546f01336b1b679ca01d8e2b192edc548123ea6be23f6f590b1f71b52c7119772dbd01d2b3bed0334fc1cd3ea5d8cb6769d3dc0ea2a9d3da1f31f26f80cca2b9798b867a921a223ed965034818006e93a217eadb5292d0dc363eddba00f6265f260d2240121fd75050458db00c50157c6b09bbefba7abe608b2b4fc44bfcaffcaca1cf142619497317bc962b34e0ae7c923c68eb23cfd3b198ec1634f0ce787fb3fd2724771df1cdbbbe0306a5c0d54c0ef69784d8c16793439fadc5a511fc4da68ff497b58ecc34d05275b4d2f44f400bfabbab05fe90de72f40c66a9f1e2ebd48337bc2db92f91dfa20343a0edf2cebf44e432617279325fd0002746b61b4da516b33bb2fc43f1416fa5842fe80c08a0b45b05a8ba6fe25218b193e03eb9581038e708b9cf297bfda550a8374524a4451766f499cb5a566953e11f3d37653033ac8bcf457c49147031d1deaf03adcb0a07881d55c563fdb2db2ad53acf00a0cc33a27dcfa6f7d4424fa7aa6361d5dbad1d3587d76b2743044998275fb9bb4b17bc323fbda194e5eb79c088a9bc4dff2f5fd3c8960bef6625c90f5fe80b4b7d1c1c996f36981bebcd772230994fe2b33c885b4f8dafd881148320cd268c86d82a9b8fcedd8d507c36a41eb1720c616377dd5ef7ae39a0dee77dc6852c15b6e035958d59c9ec365c70be03415db9dd659b39fb4679b7b1923608926479d5af4e1c5f8ffbb38f6d093fa40e6478e3896a1f40af833f54338cb8848b62cdfab37e64f5136d356754fe3fd3aa25a4d1aa9b383b224a3edd8c86502a8e3ab859ad00b7b2a680465c55402767d1d66d1a2f07600eae807c4989589b64f691052ec45729a82d941d22fb25cb5be21267cd3a9a576c55f6229ea99ab6d078389df03f77dd294c5607a4fcfa9be1f39d09e9975264ad73b987846b172e74afe706f8516b143a017573d8ecf8d2726734d661c9d4762c36e8c096ef30ea3c4cf175b34ac67ec8ec1be15716eaa73b0b7ded1916aff4baab16c1ca88deeb45234fe99450d5dd4d61706a3d708d593980660aebaf1799b2e6ead0c243baf761d2746b2a0ea5284af53f6453c7157aabcfabe747c038334634dbcec7f45dc251de54b07fa1b6e94b698093853df6f82f2d92b531496eb393a54b65f44328d3f072693c83c78f3ad0b46108ee7983c1330d446ba7b48bf1ee062f270fba20a47ebb9549dd212ff8413a337e5c8af1fb17775b8d17298aacfea4696d2a3c55be53ea5c6191301728697c546bce784690746a23dfe8efbe0e53e968d98ee83665ec1d1fea85799ff9c468145ed247c5419d55e1d14a2fca4c5365f9ff6f3e1dd9c0fadc767f71ca5437d66d42387e1fc2c98621e1eb49a0bfd000143a64f7ef57d8edb4fe22184e316fe22383a9fd645cdff995abe580b16591c232187f8749ba1f985a5728a0cca801526ee331c557b8904a4ccedb11ac917c4d7c1b56005b82dc20b15061db62e528c58d4980ead9cf514c2deae80b8459c8a5c3e22b4e7597c2a0db03ec2f86a9f244d20b514c0a0672692898e7813f0cba56c192f21bf6666b35d5def53b1de41066ff9d801195eae917338cd3351e629d8ed57c11e0e42f44d59aa4c100508fa6ccfaf152d0ee64682f265a260549822611213fab5526747acd075ab1c68a653139249ab795c25d8d6b6249277ea9ee33cd28857fadf3ca92aa3ed291929a25dda82484ccd40edb312e84aeb3adf02b59d6efd0101355065351afdede69c7611c72ada83bccde447d26ee1745d5bbbcbc5531ccaa6b170802389e99ec6c5415067d8f41ff1afe3c765b1b69d23f53c822e0b97b86aa5b5cf9ab3991132d75abd519cfb80029187c57757ffd6713a1ef38680410f47927e0a0235b7f2d2994a1aa3818223e1a25d2b9c7e76b5d780f6f51cf557111b2657afa57d99becfb62b923848efa813335c58c3134276f162606c6fb7076ba8372093f9991498f9349cfe7d6eef9eb2a2deab2b2f6259a17c7aa105d6b6f81db4eeb38f85db9495c4b3efa76f12f15e6a17cecba5f42f3598f54e218d00ee0778e164c6c447d8bc08c2848f53d025891b50302b58d7621e5d670f53a8f6adad00fd0101239220305ea7434b83c3b0f262d457d30e0b670459a91117ca1a2798bac90b64c377332b4623196c5895b96e2111797a6450fb041caaa192842ce86727f6a8036d42caddd611a12b9a8928bbeac76a47fe8228d25213f953637c1d3da50000ac5a28543f7c2f7eb75704470fe30c20f571323fed7c395574bfb79f84d8b7c7150d130f7e2fe2c82361cc9fe70e0e848ead28c754d592a8565875471afe42bc8d6da7ac155de55a2a94b2b4ffae96ac3e30059b3b3c0ce874a333ff1479f33fb145a9efd90c303914518daa3a4088e94e16871f9637e2b0ad2c4296f51f0adb266c3e66f4999871004931448c4f5e0b984ebf1da2541dbefc371c35a9e5c650b100fd00018240d05fc7d9d9a0187b8a31a01b5939f7bb14cda686bc7a7018d18b43b94be7be3ec561b26adfa0d340de1e0def2d81a46330464e8070d2b4665c75f311c533c33c432555bd09145ac24d95a7bfbb07d40f22041e7ea0ac4e886952c7a71a881b92652465facb8bee8449da27780844b70057f529660dc1c24384490865cbf1667511f9e3ff51a157fd4742b776b70e98f23c52cc8c2d0b3b1afe5a25e3fac1b08cd70e09fbc7ba683ab3354e3d6e7f5cbe4ac43cf7aa6ec819a44691a6a233fedd5ae2a9dde3f20f3d4d85c66b9bf9b19422e82e4b5c66e29e9fb504323784e99ce58d549211f119bc271380a95f75b44cab2e773b88c13bf9cebfc0767642a48589cdc28a69046edd10aea0bc4cf6c8cbe2f2423e8aba3419ff75c91b0bf2d4ea656843310483ca169a790539add5f5e0e823e4d36841cdf67ab010825c9ce59def640ed8cb0113f1492f3a217a4e4850f1878cdd0112cf7c7bd9807ccaf611a71225ceed3514deb087114c8057eb1bb8af923b418025ec3e8269ccc6d7b499ceeff011dd0abe4227c45ed62bac9724d937c72b45a62362a7eb70f000756b791e2a662dfd9f01672c4d678d31a50c754baf90f024ca4fafded6a9563ad0b8e1de7d28df10c70fb98b1d576fa457172d3a605d23588e1320aee7e402b5e45b21c3433dbaeea0c90bdfe3717bba8428612da634eb9218d91f1d50b12a3fed19ebcc5d965298168c1f404825b79b8b6270bd100dcb9fb87d441fc674b2609988f8a188b29f0e0977d2a5404e0b1cc67a7a6521f6bd0d95aca30e01866e1902ac0bf811b3abfc25c9ef735a070f4806c360770e9961603d9c367e3986eadb493f5cc62dbb87f500b573e346084e86dd5b9bcfa7ebe3cda8123c4a0ae6d87088e31a5332a165d7520122a48d248fabd5e4cda89e488b61cb2534a34184d98f340f3025f8f1393cb7b32e8a33e728680ee71287e23e07f840010b73f59fd7b926bde866d9b227fa47e598dcce9305c1ad935ad996737e58d891cf8b4b8bc5a422e1e652158e1277086515bfd27f44acb5c414c105b1c6dd86f4b7cdf0f1ffe59447f0fefa8a3609f5e96adca856cfa1a7d534ea9800b76d58c8707809b0aa8daf1cc04deaa40b5ea62451d04d8ed2b68bba6273a31882cae3eead01cde5b367ec5b225eb880b85ca6fd24011e120553fd895df32a9ea586ca3fcd09357a138c5d01111707e4b1739464f6face1ac70047630b989ef04958c70b69e55f86ab3724a46f4bae35c701d0ab36f207b0fdfe0ad90b45a226cfdc496c115e8290681884c5cb9004f6347038d593064a76dd69d8ed83b89d79b318c569c6ecaf2b8fcf74e9efe0a21fd68b7f9864d60878ba5e6d816d1896efbd60c41651d000d277469058beb45f8f33138e47985c09a634d8f0431cd1acb10836e9b8c54742ea99e86498625ca771b76fb9c1d9a4dc628e48c6c2df40164c35805ae1a301e4f8f39046ee31aeee486b4c6c51d1792d2f6b857310e8ff7f38be2ae137748f9c955b5c816c8ca5fbe7f47946ad1f407022dfa1b65c67efe69cadb0db7ee5a9b56ba99d93105a835c6f012669fbbbcb7bd6ac0d46e71af09e38dc2837121e53d5997cc40064e4f60ab8791f15007410f96d563e23db1c1d6cb258264aa258bb278446a60cc14fba056052962280c10e9c6c9f86b157dd8b7d620bfd24017776d1978268a1b18b2ae21e8bc7ebe1ada62e7508f7723b686f7774b927d6f04e898fbe7e388ef8e52fb9a494967cea4672ab0f86b5bb09641f8f005d0a353d6c8b1a750e8ce47402c256f27f6265bb902b81e39b2c6950b4e8f86caa709862777c78b3da7d4d9e46d11bf7abee73358f1e2f2f6a5251844156bddf32ccb62c63458df53ffe28f0c0101d39ee5532675f854e789e3d3b63d1a114c1566fc59ba6774a040f51a8d96f81150f1a4af00b2b15fe4630d41b6795ff654f176ee0d7b74fbe5a85ba97f5d4119bc30a2c05b7bb470534de7a24145ea42cdb0c0c619fd679348511f56118e31425743fa5f67f6f4274e4d1b6c0976781670577562b7a43d3aee21030d201696d145aa5fc16341b5e0e6e93d10f9695c05ceaaaae8b1a9b9ac1b1fd240124fa264648261de73c48b0c877b6443dec81635bdd556e07392785cdb3477c6eaf3a055a75394a125b1fa40102ed1982f9a792a7ea620c742eaa9672bd858cbabb4e880b4c5695f91bdff28cd119941203ac1d73a8674b80652ce727c2c53d79091b8c6e66986b02667b32ef35856b6c454d4faf81ab86f3ac3ea99a125cca18db761c1470c9da9d038c182767374506d54841706d3267be0619d85a0deb74858774515d30f8ba0bb9b4c326df3b0781ae638d6778a2124e47008c9fa73aa2df4ac9242dacf176ffc09fc02f10962aed582cdf8869edf306124c54cf1ff0c6e37204d7674f957e2bfd883730925269a53076a591b467efd25b196cae786045711d7fc5a43d2406b40f09347da90e1691660e09f2ee4a5d58f27c29dbf8eb6dc6ce479812fda001e072203d6feef07f9019cdc9085b5bc0f3ff4c0d3360016386b0ad64f71f8b43539684436691e0e1af8883e307994db6467ed87cb8f6f7c321144a4b60f8c98fd47979782a870b5b75ea4d6a06a1cdcd92358fb2abc835ac9ea7371354a1b0093ea3e7c2bcc6a7bcd18e1d6b4bc725c19b02eb39414935dbc6b3fead736f41c84254b92b432099396c28759c7b77559018ed5a805484904c8299693ee55ba59177399bb5ed2692b89f8be415ec35aa4a07e97cfdf082380eaca62abf8a4021afb960c1e2736566e46738c8b2592f5d97f7de1eb9629112fa6cccc14b70d18bf2638e2c0e3ee3b2af7b035d432df73b47b2786de85685297c7d580e6fbbffa54552e237b7311365b35891a786be61ea21a1a5533e00ab0ffe9b0f378f0525a32e11057e4cffdb66ba2e90bcdb412306d82dfd3bdc65e8c62010d85eb9fb89d000b950e5cdf140c014c8104908351e1a1f0c056819074bf10d2c720f41e627ba644357c2aa13dd14ca6419a113e1e43842030863d24cbca3da6c13bf6c06c8dab5bff38c3b4aa0c71e88d56a327b43abb8a6e686c6c71e0184ee38a73f78068580601dea76ecf2d617774af0b12cedd20ce49bf94b8f7f6572134523b6d544349ad254e42eb3d28781d4e90559164fb92df35f3ff9e1305937a01c685b5591a776602ac4c26a45c98bf735d31ca89e6530af835a5c9e6f363459c84ea7ad1baf3c152133e8b9caf058b66e9b5e755da550c2bfe0f4e3c6010bd1b29a791dc63dbd1bfc0046c0cb78340662658ad5f8806a58f489585cceab2546513e987ade74481e888d56bace3b36c81cc268fe54d3782625f535bcf40196b37ff4520a475349488482bf63f5dad639026088870129a5c8e35a21b0c62fa1cd788afd6841803f608f5205c182a8657a0e1a235aaff04bb032442bdba62e950db842f9fb80cb39db4711e2ae5fe063233bd92ed64ae13717a948a86932bad10c52effb382a062dd5d29f1eed528106402f2802823dd4e288305063c21725c6d1cb372de09adc907fe8e0b3bcbde95ae50051fba4aff3ca1606517f70b9373e4147bbfefd77abd1138d32f6067cd2a20253bd7c903520b8876f59afa8c6bcdfc9dd2be656e9d3a55d8d4e4b7c977d4a9701a968b1e859ba5c563ead8a992576a5b1b6d4ee124ed8bf515503758c472845c29cd193ad00825943ed55c105e86dcae6b9384e389cd8498a13c597b8cf424704eee6e7a42751dcccf0acc2f8c2900cb14aa987d6616a7f66a6678202e005682ef38255d17712d2621e65595a28172962420dd665c1216ed4ec56ae22f192b341a8216f53758a94e4e6e67c116ca95ddc560027cd439b48bb466b4089258a0acd77c08dc9a0bb9f00028218f101261fbf111b98c9a5e0525aaca803e0af059624ffd3a6ae49d1af2bcfa9d406983948c5923a3c8aa76351af14df792806f42e328bed7f60c0df3baead73da5c9c9750c5683fef0579730e74229a73cf77f7598035b21b026a4997639a6d9d859c2a0dcac16c02b0865f154f7a311c72bd5c67e98f150791082484895a1abe0081c98d55c871c39d738cf8a445cd1b8833164771aade1d436a788e333e8fd8f2c9c4027ebe7bf5db8dca65882bb15e53ad8a70f607578c30cc3cd92d2701772a10421792a5e1898baa3d75edf6cb338eeef4bac9e3fa8f1b3dd801df9561ae5261d744d325dda6da76334cc1f9c0e13306a2adf1515c58d97601cb42c9d363afc867018260eea2ab76c8c224481a8e3de7e1396df0a84ab3e60838fcf3ac270e9f4218fc0c3ea6037b5fcfb34a8686442abdc712adad4f342c35e7dff6c9f0301c92c2f34ad9b244c2b40e5f0ceda661148590a30299ba6dd6ca8098b1c58a84fa0809c2dc0991f04b3ae584e79b077a62400ba18d70734ace717647b1dcc991492017d0da008138acad616c729bb9996cdd0cd129e6bbc59e8b8508bb0fe61a8ea367048f19286c1a4e42bc1ca81c04bc39912e8886a99d444f211881f35a62b777b624b94ab7fac173c7a5fbd7c1249348cdacae2b3db9ac5ebf9c7652b4cc1cc058bb9a80cf0f5730d4a827f37437bfc4225a910030508ef9549d4e4339bff7bcd9a256aa862a824af84097dda22d4aad5517675ab64b632cf82d556557f1143ac9d1ab0888fc1d5e2bab5c4705d416ce5ef340cb16fa1a9e1ed83b942d96bab1ef62a35e9115bfaec5776c1daf56224c003feba5083245a6e94825a7b27144fee821f89e9c1b90889956e8f61a5acada9b6ced4d54962057cd6d9486aad3bc04f09c424e8f47c988000382f278f2b260970ae68367fe66d1844718830dc1d1a55f6ca6316c52ab789b73e05f969b167f9dd470ef1cc4553204de87681edea6be2d2a89b24250735b4cf1610c31ed8b8e78dc0a19e2210ea3cc1ee1802899644ef46f79f78f4fd2780e296feb66ffc105fed7468cc4167df02fd335ccce8bea28f680b4c6c4cc3434713421940082e3bda6c34522b2fb1c0ad4f01cb66b547c70fde51aae7d3fafcb20b79c9eb353cb8fa162aa03c7f4ac035689b007dc0518f7444f7689ed1d3486d64f8be9749ed3fc5403e58de0dcb170629f71157fc7dcca2f6f1939aa38e07cbbbe5b857a47eb2a13eaaea392216a1330885468f23120952921dc4693ec358dc3ee0e930bfdde00823ed7094057626f326eb614a54a5a06e2ad8a4770c0e365ba9c9aaac61323fe37dd426657c5776743342f9ac8ad44630461e4c457cbf05f19420e59e1719b70a7e09cafc6d70478acbae800d00febcd3545ad9f4c262dbe64f12ab2084cc6280d402478740d6ac124b338fd874b4d5cde0296768536896fe6bc030521fe366a10e80005814b021d9246746a381dcbda188c344ea081927066c5ae2a9dde60e47f1d936b5b0ff6dbc9328259d48472cc87432adce60504fc8005e7e446950e2d2d8725f7103668e3c8021537ba925ebe6a0f283b271d2369dbab9d4a2f0b4d304488968e16f00e8cbac850b955bcda4c3e4c4d9c60e4c165d4a49bca946bf4c297b43772575d8196a92c8ec6659e681ae21831783f8c23d5241d551b6b80fad5aa574f16686449c222d9b895c20e9320adaedc1b3f069c61cf0c9f31c79c0b2d0ad70b8316c4e2746d6d93a52b4414750735fc268c1459fa4b202650e774b1d1ab7a5a9269aa9ace0d6af3ed20ac69f005331da925fe7d8b96f1aafa6a711fb054ce5298e52be14e82ae8c0cb4c1a3a7086fb3073d9a11a6b882b9cb10a908ef2425a9e5a39b3c2f7a3a8e6d237c724ec0310b4f519efc0fac69330f18c0c37073b13ead0309f90b66f9d01c6aa582a4997889687238668082565db19c147db22a6e701f4a737129e0fa17808340784cdd4d35bd3f50871554451fefded0b7ce40e1234955e0ee7bf0850082276b8d5603defd1c08310d8af9069842b03c2f9ccc26a273aeab384d00ecdcbe9b5297968231311fd5ddebfbebee39a9288bfeb0732eb538e5d2320ef1ca9cb0423c7ff6a2da12c9c4767d9c924f58624c81aadcf6d33255ddaf07ab8a10bdff403215ea52ecb5ccb1c563f275c1a84bacbc280abdb365d99efcc0009a9637ba8c00829d4b5b97fb418073f13c868b70b8c83c4e440223cded3d1a20fb65070cf05c1af4ef5b538c740fbccaa8770dc5ed39fcaa83dea0d57c32c5a0f33d9aa38db69970eb903027856fc01caaf3f2849ffbf5ec80f3891d5178530d650bf4cdbc012beac50fc84dfde37bb6ddc304f5b59658690a4d5b8cdea8ccc5f4bedf6ca543f1aa0081eb7940e56ff5f0368f1f1025ff66599e948e97910e2c80f496b53892cef73e6366afd36c7021c5d159216b57087a4686b14d8bbb9996d0f5dac656f231293e37ac2d8dfcf626c9efddc509affc26f78d230ef7cdbeafbbf40d0fbe23ed3ccae9ad988fd2cf7eccea8e5731069e50f98a3ff8f73c41c87ecb7786d029c95c65194202819e21a9ab3d3b34165769acd5fa93f851767a264c525e0187fda092f9e3144ea707046749ce5371d30f4d8895120744dca958dfc7d120d983a350da2da6e4f03b4ff7b48f573877928af6ad44c7c5ee63d6502cedae2d318ab3121f7f4a72de3ef6e506dbac67097d6d9f9a80b23f95cde1ca6acac0058d988ad37286c38c53cf00813a804fcda9a32c0f6c185905e65f0d388ee5b15176d737a9c4202ba2639cfef518dff1151b6b93cfba1bf1ca448a120a244ed197b9c82bc1341cfe33f71ef3db5d7c0a754a931032d5e1adc238a47063af9fd26b7ab8b5435fc49c078433b025a480f4e81acfa28441bba39b03615e046f365acf3ded1dbafd166af7a86d56e40081056c35d6fbca58892f2bd6c7324fc6dae8ec789ace172d391b9b0ee89e8f933bb0b6a862954b7445c29244afd34dc312da40d64f8b3f14284e72fc581d90c4e48af9553d125f91bd1f104f591dc491d1dfe480accae224f1415f720ab8b218fa585c1f04b84b4ea8ba364059ec6dd872ada72878dcbe5cd2561bfaed6fc6cde2008120b88c43e1fde4d8e2e3306342eb020667f41f4c37ef1e8785e5786f88c000bee3628545fa4f53db3ae76974c1a28b99d357207a725dcfdb052508d06fbc335ad3fc36ab1e9855c71bf8130190cda34a6d19c92c595622177222e358f9ce26479eea02427281345904b18dc3438d34aa4eaeb79a27449a82d66679eb1d9a0aa900020981260379b0b6c955904d621d2d9914fbf5d6eb83ce9b49ec306576436ecd86c6c40d624ea38a274745b7508c4aed0d60be4b4651f7941cf602082f895e683be662afe48f7a24e8595e4dfbb34e396ff899a0f085f846a3a4fb31dd93fa9fa3e38cdd964145605a59540fea8479fce2e42a88c968413ee76a4670f6cd28af7792dc3e812fedb6733fe00a0dfe30211ce2edf91dc38e6ef0c53b60ceb0c569856f3800663276ddee26f7fc0eec6a280fc3a30a572b3657d6b386a09a707bf2cf0634c9baed1dde50be2c2a09cda1c8dc2cfcac780f1a2cb4d8653568b37b89b52f307e97b682dca367916e964cfe19eaac4727c272fb1b9c7c4d5736d115a46e50f37d72268286d6ce55d021537aa2a8808b7726d878f4a2120824e0f02237ecf03d0eb2a1fd6f0123da00a11893bfd2a8872644a56c96030ba73831bff4dc0f13dc5b74863ad229a6e9ab44db4bc5d8f41665bd36311c2a8ef2fb683c4d88bd430f871a7eab137fc0dc37a030849739e50b19ddacd59a9a0770e2b13dbb035386f62046b596930082702873c7ad238d3844d13585ad38041e3ef62397106d92a0baa2eaa35b29c6492274b1a0ae47c2230fceea9400797e1a7ab5f4e9110945e1c5718222371283b82da3f47fefcc3cfb4a5580326eed27b5fe0a282a3806231ed7649ec97709e529745ffa85ba99d38b8467e2c725f2e3af145e743e4fafdeebdcae66d488f3f728a400820562f8297c97d05603ed840b6f841d0bb40e15b9878480c5b50f3036ff4daf21d3ff1a079bde8615bf53be2d87456fa1a88a6dd6d5c7900910abce16996125b343ba481cd970093b843c4db632e2876ef75e67f9d460c1bdb8c62a1f1dceb60eee95bc2b9906821bc1b2f61e50c6276f2ad1d996f397f4b73e4499dfcbacf53c9a008218a751fe167f1c3b14d16a0bdb3ac62eac2bafdb0052c12e7f52024a6e6298398e5bf7370d13534cbdc6a984bd70bc494e7af731b74b2588f5e36887f46cbf9de979869fa3a2354bd29a3cf9d0431d7fb544245cb164546610c15246c62ec4640c576a49b1e21f24ef9ae857107f267be4bf7d629af9b4fd9e46dcf506bf0f25a70081caff7f8760bf7cb30e1c62357fa6abcfc4f13fee9acbf7d828fd8f8dd1f3bb535a01d125ad130bf200d634a9419753598ffab460cb06b109b6e22a270d126c6b92c37f71a380dc5b0c3b913c672eac6699e07102d175a64ebd5974bbde40d514babaa54d81aa4d892eea6daf07a97335ad40899ddadb3488c27a9397a5788e923781b04a15dd026532b95be1561d223e23dc7d628f99b8c145db2e7bc439cd865294f4debe8f56ae1a4fe3639ebacbe02078ea72d64fe62a2614eee93b73f26291128e07184de84b65e58813bb19b45fd3b18506fc5c20269df85e6bddd5b4767c0c2856c16d09014456ce257f9804d29b202dbf5d9243df560833a700c703f4c4a43081f9a24579c508eb99f7d4d774f45ee8f2711249ff12b6ad457b636d3a494faaf23f7a806095356fe39a018f10348c4fa5a416133096f6b69b8b1a81c0ec9579a0bc2e9ba8d4cf4ab2555de0d845492c2ae4a948dd3e2694908e9b72d0faf93b3ab519948355d7cbeabc8d41cd5d4354ac3e896868097b281e742a5fe078692bbf51098168bbd2bc268af84babad9904b369755c32368387faba9a0e5839db3ac7f9ce6766ec451d5cb80ac504119bfb27ef494bac532ea312a46852ee93d160bba29a0b4dbff8a9081cda700e912f730e320280d262d711e1775b450568ab8300b178f409c073690a15d6b5e583d6258db7f75fac42199c304bb7db7c7007c55150e87868826926a053c4d3d6556a0e71f6c9e9673313914bd7d8d6e31a7d07819d2df710bc95552c50cace61403b95487c5feae484cda0edf80571b7922c77b6d92ac89a8825306596f8cecaadaf584a0dcd65e92aa9717c7faf0610f9ad199c0ae4f8de4b6850de11ea598048be695dd77b1563f4726a7f8baa11e0d52a34de05e13c4fe7c200825664d52a4659bffc66c6c37c3147501c172a318516d3011e9dd5654059f5b34b852bcdce5212e52b099a32e8a3195498b060d6333ba0bd0932e1e8f4a7ede54f9f6e58f1baeb62d8b3aa99bdb1df351ca80c9cd1c24309f4469154c47d8987f4cece52825387eeb4508025b2522bed02bd410e27831a05e9c8ec92d8eaeb8c64ba00824b70d5a6b0c492330f68eea8dd8e44b491d3159bb0a023f055afa86659c869f3dcf6764274e8cdd135bda21a8faaacd1dc30589654b95c825fcd4c69634e1734e795cf3be4f604de00172a36f5c73f068fe0f4146e09ea808429d60139457132bc6d4daa9eb8c8cd48907e2d145e64556377ba4e47ef038b4a52e706ba460ee3cb0081c81a89c675fafbcd69076077d2c494cdfc1ad82f065e5ca7f4e8d9ed060519968b18cdea15436675baf5026937a1fadea4e0dbed69c1aaac29eeca0295b914fbdc624b00a4c0ed3152e3c2906d90e48847f7161305ce2fe297da4c74b92a6bf02591964409ec6fcc0285989c067e04985973d08d574898edb5b809dccc60ecaf6b825160d57dab9bd8ae2cdb6a3a096e89e721fbc50cde0491cdf523b4a96d898daea4124ac9f418372e2b7838a709fcf9989589cb38972b999f58bd4c51ff96f3701de16d6b92ca95ae6cea50ee1fef1cdf23a16e07d1bc06f301261d6650f83ed4900fc5c3adb5e8d9630bec47d474c80b046d3a7d9f4ec9a747fd44860e3fa609e30081b3a5db872554e40f85db5d7809fa371580f50788b2e7d485cd0b52d85740e596c501733d8058b538e3cf76081a9896bad5d1f72659c83415dafd01147b5df001225fdaea572841e5d036c084647261cf6a72d4957aa748874b68d5d441dea2dbbc09d791e00c338ce3c0ebb8e133939ffa19ef6f7d3190315ca218620a22e7832281a761a14011fcf59dea300f30a12b7ba865e2a872da49a42089835ba4df6f3c786f09e1f6c2754b812fa47ee9a8daf62ce599de8f9e8ade80605b17ffe47501d05228c7f475df1369602866752bdf6ea0123aa18171cd5c094311fba3b98c0534f2398c10729703fe3b4060747ac65edfd777b20514675da01ec9a3e368e1db2b3882ca6ea5b62835e344cdd51af4a4d3cefca4ee45d74162d24ce94472b4fe54ec50d0c53739a593ca9e2bdca431f7139713885d08bd4320600ea1f86afa859f2799cc3588e2b4c9ecb2cda77be59983bc2aefb564cfcdf0231e71ec8ef4fd1f88d4ac21ffecd48ac2fd7dd92f0c8a6a8941c576ab748df0374901bbf3b018361a9baf00010181933f282b194ca2e345defb724e9fbd46543bb04b8c7527d3f71cfe114c1eb28c73682e994ab5df342bfb2ada8f0236ed42ddb51a194ebb4171e126c732b34a4e5a6bfb618f5f9b92f353d85426650e0a0379a5ddfcdcd874ba9222d41085746f03836132b48a60044987edc38f1fe15ca57c5e76bc15ea1cd0bd27f07a6ae784000101808e5e203bc8541167aa7874c87607ace14e7698843be5245f8fd7252aba6bfc3f1fd63914f12e273f90c158599ec53b8aa123ea4caed8d99e0fe00a46d8c88ffa37e4502729cc3e464e213659b8feab44a97516750edf9f76a16ddf1d0c4d8a66b7cbbbb271d7656fbd9d124c913ddf5fad76f2dac1f4d027909b5fb29009ab10e2666c02873ad06a52b2b7bca8f65f1073c522e16c031eb1ada597ef98039a12538cdf80f67727201b5722f639a84f655bdc4cf7ea6030277263017a7b4a9b305167a51142bcce3f61d4e574b6f8f96b7c35ec32ce326c210ef276ed5d916de018f1aeee32e33a6cdaf8d1a236f8ac7c3d725d37ecbf157fd35cec97237c716584372c2884eab27ccb6d400f300cec9807def5097d5b233bba7e6df4ba5e61e0f42e572c847250c857d540cbe12ac9fa57c0c5d82912c7a4c455c42838ebd82076aa263d49db003e42a89295143483dd01bb475e727155f8185248acacea960cac1b01e2618d86fbb043a8cb40c2c36098cd27d9bc959af4323141aa3b230e9c6a5f66efc3a1ac8cda15bea02726e6995560815edd200fe210a44539062c9e5da8012c4c7ca28ef24571dfae702b1a790f7b765a3af57bd15af254b597678c6ab819069602507e2c8766d056f7096b271652e98182f8566b8beb67b2246b3440416ffac3312f0f908251b08221e969f3ba8b988931041967b038b6a20be067b307908b2ccaa2d1d5bcde67fff76c844fe3f99f8a263ad4d1161658728c391f5cec2591ecad84d367d5e40aabe6815fe30d1a1346d9c07cf0842f62d1cff1f986a5d2bb739601e28b66357d945c0d9ccae54e629cafc63329c1530b78322bafa58d63431d314d3d9a627cb67428bacca2dc90d4236d49598a3200e039151c81a959e23a9d7d8ff47b9db913be03e09080b0b18253255b5c3fbf8351e8053a84c239916da59bb750a9c9330af5db6151eeca511cd6418ad5f796e4743c28e218efca719ded2d164df5de81de633c3dcd080e6f0a12900c97d44eec7bfbe445a067f036204ac889ae03e60e0243aabfd3459ceba5a402a48c09d4d349cd7b4a931b2a9b572cee5b95c00613aa3462fbfb3a661248b2785c4aa9230b98dfdefad97678921af2a00b981f01206d3cb4f6542eb74a0480c1b94bf3377fff8f7a7af6e912eaff318f808ae860140180f32b4abb70ade6258f88cf1861c22b0cb0a6b858f0c9b9dde4df1b6ba5970e4d7b661c4a41a014f51125fabc73b69eafd6029648069bbdf1b7fa8b9a8e818bb45ab3b5583fc46b72f085458ef8d2f7b55e4aab8a3463dfe758fb82b17f0bfd3c3cee1da6da4d22531d884494af2b313896c85f9723501654d6cce623836c1f1e809020ed187ea447019f1a2753de793bbef354973a1bf89d26e1b170de0933677c6d31431cd1782ec0cd6b55f94d46577918381d048162f1ebc790309164cdd13fc11fc16017893d8b87e89c6bc4eac44c7e637a931fa975803f3a11bd5b4381d5964c58fd22ebb51c126c3e1dd40a2b48b3e6b975494626d7a396616bbe243a1a102700800701000000000000000000010010a5d4e800000087c10281004c8109ba53882c8a9a0fa42d58bf0127118befe607209983ea57eddb1ee2f0110e5ef11d807603041554305c1a5839e38bc415c01ac04535e816c0667d4621148c64d79e1fd8116404aa0c535838110628c0960a304dc00f030c1c04166b1b6adcef3fff2e2ecb96cd12a8baec37418d8655c987db8c9e354470125b76e572ae658d000100ca9a3b0000000086c10280004c80bbb0308ccf0b91bf331652189892ba12c7c3fbad0ff12db3fc8f06738d51a109a585b6e404d3961f51686427939f6938ef1b6e6393eae745f1f4cb635e3322c432f66d875782883849ebdf39131af995212eb1bf583d6ff06c90d1e641820b230c83a3a0ac0791876ecf02fbe9ba8540c34645d39d10bff51101a793f3b4d95f0100ca9a3b0000000086c10280004c80b16644a31864685d404011147c1ab0993df6e396a2125b1d29ddf3f40f5c7c5ffb33284a4379ba7b7fcd5f21894bf79bb05b9579bd20207e97ffe651c9d61d5d90cde171cc81b5719c1296d94999c8ecd5b0a5572f93724ffcf6d615714a734ae04a0009d547845841d21005860204a3539aceb6ebef64269e07ce11b8e98c460100ca9a3b0000000087c10281004c81a505432e6242f8cdb6511f0710af7e2eb3c10464e920a49863973af2d9aec670de01896e3bea3443dc7369ffb183997882abfb34335bac9efbab0a8c38cef041b96e9d51d7dba1393fc4e49b11aef14a1db8642edc17a4b01dfbdd00c81c8a8410362768795fc509214c23d668b7e3e2309020984d9ec8f774ac11a8f0fe6ecc000100ca9a3b0000000087c10281004c81035054ebdd783bc8d39c9768197c24d6596a5e062a88cbf34450685134fbbb7be2f2e1bb2810186c9f7aee138015a88cbdbdbe13de93a6d9e73b3dbf72204160116742869e52207ef9e7dd348d4cf8c2e297069afe21848010e410f281fcdd88bd8c3cbd4f439555d2879d359295439afa1a2b9b263fae065db909563164d7c0000100ca9a3b0000000087c10281004c8101b3284d5b05c2ce81076c6df0f86bfb51a80b5edf43b8f8a03baea9bda2232989e511b8cb2b4e56c4c6433a25ed4d445a48fa1651bf4251c69872d5a17a3c4dc7b6270362396b8dd395c4c38d1d24c47dcedeb8a9449a90b17a1e9cef44069805a80e2c4b81abc84b85395a4e2cf5ae788fe6855a19600b97aad49b82ebe79500";

BOOST_AUTO_TEST_CASE(checkpubcoinsig_test)
{
    RandomInit();
    ECC_Start();

    CBigNum bnTrustedModulus = 0;
    if (!bnTrustedModulus)
        bnTrustedModulus.SetDec(zerocoinModulus);
    libzerocoin::ZerocoinParams zerocoinParams = libzerocoin::ZerocoinParams(bnTrustedModulus);

    libzerocoin::PrivateCoin coin(&zerocoinParams, CoinDenomination::ZQ_TEN, true);
    PublicCoin pubCoin = coin.getPublicCoin();
    auto bnPubcoin = pubCoin.getValue();

    //! Expect Pass: Standard scenario
    Commitment C1(&zerocoinParams.serialNumberSoKCommitmentGroup, bnPubcoin);
    libzerocoin::PubcoinSignature pubcoinSig_valid(&zerocoinParams, bnPubcoin, C1);
    std::string strError;
    bool fVerified = pubcoinSig_valid.VerifyV1(C1.getCommitmentValue(), strError);
    strError = std::string("Pubcoin Signature Failed to Verify: ") + strError;
    BOOST_CHECK_MESSAGE(fVerified, strError);

    //! Expect Fail: pubcoin + serialparams.grouporder (same commitment value, but to different pubcoin value)
    auto pubcoinSig = PubcoinSignature(&zerocoinParams, bnPubcoin+zerocoinParams.serialNumberSoKCommitmentGroup.groupOrder, C1);
    auto C1_mod = Commitment(&zerocoinParams.serialNumberSoKCommitmentGroup, bnPubcoin+zerocoinParams.serialNumberSoKCommitmentGroup.groupOrder, C1.getRandomness());
    BOOST_CHECK(C1.getCommitmentValue() == C1_mod.getCommitmentValue());
    fVerified = pubcoinSig.VerifyV1(C1.getCommitmentValue(), strError);
    strError = std::string("Pubcoin Signature Failed to Verify: ") + strError;
    BOOST_CHECK_MESSAGE(!fVerified, "Pubcoin sig passed testing even though it did not have the pubcoin that was committed to");

    //! Expect Fail: empty pubcoin
    CDataStream ss(0, 0);
    ss << uint8_t(1) << CBigNum(0) << C1.getRandomness();
    ss >> pubcoinSig;
    fVerified = pubcoinSig.VerifyV1(C1.getCommitmentValue(), strError);
    BOOST_CHECK_MESSAGE(!fVerified , "Pubcoin sig passed testing even though it has 0 pubcoin value");

    //! Expect Fail: empty C1.randomness
    ss.clear();
    ss << uint8_t(1) << bnPubcoin << CBigNum(0);
    ss >> pubcoinSig;
    fVerified = pubcoinSig.VerifyV1(C1.getCommitmentValue(), strError);
    BOOST_CHECK_MESSAGE(!fVerified , "Pubcoin sig passed testing even though it has 0 c1.r value");

    //! Expect Fail: commitment to different pubcoin
    libzerocoin::PrivateCoin coin2(&zerocoinParams, CoinDenomination::ZQ_TEN, true);
    Commitment C1_alt(&zerocoinParams.serialNumberSoKCommitmentGroup, coin2.getPublicCoin().getValue());
    pubcoinSig = PubcoinSignature(&zerocoinParams, bnPubcoin, C1_alt);
    fVerified = pubcoinSig.VerifyV1(C1_alt.getCommitmentValue(), strError);
    BOOST_CHECK_MESSAGE(!fVerified , "Pubcoin sig passed testing even though the sig is made to a commitment to a different pubcoin");

    SelectParams(CBaseChainParams::MAIN);
    CMutableTransaction tx;
    BOOST_CHECK_MESSAGE(DecodeHexTx(tx, rawtx), "failed to decode raw tx");

    auto pspend = TxInToZerocoinSpend(tx.vin[0]);
    auto pubcoinsig = pspend->getPubcoinSignature();
    BOOST_CHECK_MESSAGE(pubcoinSig.GetRandomness() < zerocoinParams.serialNumberSoKCommitmentGroup.groupOrder, "pubcoinsig has value greater than group order");
    BOOST_CHECK_MESSAGE(pubcoinSig.GetRandomness() > CBigNum(0), "randomness is 0");
    BOOST_CHECK_MESSAGE(pubcoinSig.GetVersion() != 0, "version is 0");

    ss.clear();
    ss << pubcoinsig;
}

BOOST_AUTO_TEST_SUITE_END()